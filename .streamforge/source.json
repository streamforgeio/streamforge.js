{"name":"ico-parity-compare","dsType":"kafka","components":[{"alias":"ethereum-trx-calculation","conflationContext":{"type":"none"},"sinks":[{"alias":"eth-usd-out","@type":"LogSink","source":{"alias":"ethereum-trx-calculation","conflationContext":{"type":"none"},"sinks":[],"@type":"Source","scope":"local"}}],"sources":[{"alias":"eth-pending","conflationContext":{"type":"custom","func":"function(s1,s2){\n\t\t\t//print(\"s1 amount:\"  + s1.txId  + \" amount:\" + s1.amount);\n\t\t\t//print(\"s2 amount:\"  + s2.txId  + \" amount:\" + s2.amount);\n\t\t\tvar trxs = [];\n\t\t\tif (s1.trxs == undefined){\n\t\t\t\ttrxs.push({'id' : s1.txId, 'amount' : s1.amount});\n\t\t\t} else {\n\t\t\t\ttrxs = s1.trxs;\n\t\t\t}\n\t\t\ttrxs.push({'id' : s2.txId, 'amount' : s2.amount});\n\t\t\treturn {'amount': (s1.amount + s2.amount),'txId':'total','trxs' : trxs};\n\t\t}"},"sinks":[],"@type":"Source","scope":"global"},{"alias":"ico-parity","conflationContext":{"type":"none"},"sinks":[],"@type":"Source","filter":"function(s) {\n\t\t\treturn \ts.market == 'kraken' &&\n\t\t\t\t\ts.ico == 'eth' &&\n\t\t\t\ts.currency == 'usd';\n\t\t}","scope":"global"}],"func":"function(p1, p2) {\n\t\tvar finalTrxs = [];\n\t\tvar trxCount = 1;\n\t\tif (p1.trxs != undefined){\n\t\t\tp1.trxs.sort(function (a,b) {\n\t\t\t\tif (a.amount > b.amount) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif (b.amount > a.amount) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t})\n\t\t\ttrxCount = p1.trxs.length;\n\t\t\tfinalTrxs = p1.trxs.slice(0,10);\n\t\t} else {\n\t\t\tfinalTrxs.push({'id' : p1.txId, 'amount' : p1.amount})\n\t\t}\n\t\t\n\n\t\tvar r = {\n\t\t\t'amount': (p1.amount * p2.body.result.price.last),\n\t\t\t'topTrxs' : finalTrxs,\n\t\t\t'trxCount' : trxCount\n\t\t}\n        return {\"request\" : JSON.stringify(r) };\n\t}","@type":"Zip"}]}